<!-- templates/add_property.html -->

{% extends "base.html" %}

{% block title %}Añadir Nueva Propiedad{% endblock %} {# Mantén tu bloque de título aquí #}

{% block content %}
    <div class="content-section">
        {# CRÍTICO: Asegúrate de que form method="POST" action="" enctype="multipart/form-data" novalidate esté presente #}
        <form method="POST" action="" enctype="multipart/form-data" novalidate>
            {# CRÍTICO: Esto renderiza el token CSRF y otros campos ocultos. ¡Esencial para la seguridad! #}
            {{ form.hidden_tag() }} 
            
            <fieldset class="form-group">
                <legend class="border-bottom mb-4">Añadir Nueva Propiedad</legend>

                <!-- Título -->
                <div class="form-group">
                    {{ form.titulo.label(class="form-control-label") }}
                    {{ form.titulo(class="form-control form-control-lg {% if form.titulo.errors %}is-invalid{% endif %}") }}
                    {# CRÍTICO: Este bloque muestra los errores de validación para el campo 'titulo' #}
                    {% if form.titulo.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.titulo.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Descripción -->
                <div class="form-group">
                    {{ form.descripcion.label(class="form-control-label") }}
                    {{ form.descripcion(class="form-control form-control-lg {% if form.descripcion.errors %}is-invalid{% endif %}", rows=5) }}
                    {# CRÍTICO: Bloque de errores para 'descripcion' #}
                    {% if form.descripcion.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.descripcion.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Precio -->
                <div class="form-group">
                    {{ form.precio.label(class="form-control-label") }}
                    {{ form.precio(class="form-control form-control-lg {% if form.precio.errors %}is-invalid{% endif %}") }}
                    {# CRÍTICO: Bloque de errores para 'precio' #}
                    {% if form.precio.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.precio.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Ubicación -->
                <div class="form-group">
                    {{ form.ubicacion.label(class="form-control-label") }}
                    {{ form.ubicacion(class="form-control form-control-lg {% if form.ubicacion.errors %}is-invalid{% endif %}") }}
                    {% if form.ubicacion.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.ubicacion.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Municipio -->
                <div class="form-group">
                    {{ form.municipio.label(class="form-control-label") }}
                    {{ form.municipio(class="form-control form-control-lg {% if form.municipio.errors %}is-invalid{% endif %}") }}
                    {% if form.municipio.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.municipio.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Estado de la Propiedad (Venta/Renta) -->
                <div class="form-group">
                    {{ form.estado_propiedad.label(class="form-control-label") }}
                    {{ form.estado_propiedad(class="form-control form-control-lg {% if form.estado_propiedad.errors %}is-invalid{% endif %}") }}
                    {% if form.estado_propiedad.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.estado_propiedad.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Tipo de Propiedad -->
                <div class="form-group">
                    {{ form.tipo_propiedad.label(class="form-control-label") }}
                    {{ form.tipo_propiedad(class="form-control form-control-lg {% if form.tipo_propiedad.errors %}is-invalid{% endif %}") }}
                    {% if form.tipo_propiedad.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.tipo_propiedad.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Campos numéricos opcionales -->
                <div class="form-row">
                    <div class="form-group col-md-4">
                        {{ form.num_habitaciones.label(class="form-control-label") }}
                        {{ form.num_habitaciones(class="form-control {% if form.num_habitaciones.errors %}is-invalid{% endif %}") }}
                        {% if form.num_habitaciones.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.num_habitaciones.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="form-group col-md-4">
                        {{ form.num_banos.label(class="form-control-label") }}
                        {{ form.num_banos(class="form-control {% if form.num_banos.errors %}is-invalid{% endif %}") }}
                        {% if form.num_banos.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.num_banos.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="form-group col-md-4">
                        {{ form.num_medios_banos.label(class="form-control-label") }}
                        {{ form.num_medios_banos(class="form-control {% if form.num_medios_banos.errors %}is-invalid{% endif %}") }}
                        {% if form.num_medios_banos.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.num_medios_banos.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-4">
                        {{ form.num_estacionamientos.label(class="form-control-label") }}
                        {{ form.num_estacionamientos(class="form-control {% if form.num_estacionamientos.errors %}is-invalid{% endif %}") }}
                        {% if form.num_estacionamientos.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.num_estacionamientos.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="form-group col-md-4">
                        {{ form.area_terreno_metros_cuadrados.label(class="form-control-label") }}
                        {{ form.area_terreno_metros_cuadrados(class="form-control {% if form.area_terreno_metros_cuadrados.errors %}is-invalid{% endif %}") }}
                        {% if form.area_terreno_metros_cuadrados.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.area_terreno_metros_cuadrados.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="form-group col-md-4">
                        {{ form.area_construccion_metros_cuadrados.label(class="form-control-label") }}
                        {{ form.area_construccion_metros_cuadrados(class="form-control {% if form.area_construccion_metros_cuadrados.errors %}is-invalid{% endif %}") }}
                        {% if form.area_construccion_metros_cuadrados.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.area_construccion_metros_cuadrados.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Cuota de Mantenimiento -->
                <div class="form-group">
                    {{ form.cuota_mantenimiento.label(class="form-control-label") }}
                    {{ form.cuota_mantenimiento(class="form-control form-control-lg {% if form.cuota_mantenimiento.errors %}is-invalid{% endif %}") }}
                    {% if form.cuota_mantenimiento.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.cuota_mantenimiento.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Campo de Imágenes -->
                <div class="form-group">
                    {{ form.imagenes.label(class="form-control-label") }}
                    <div class="custom-file">
                        {{ form.imagenes(class="custom-file-input {% if form.imagenes.errors %}is-invalid{% endif %}", multiple=True) }}
                        <label class="custom-file-label" for="imagenes">Elegir archivo(s)</label>
                    </div>
                    {% if form.imagenes.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.imagenes.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

            </fieldset>
            <div class="form-group">
                {{ form.submit(class="btn btn-outline-info") }}
            </div>
        </form>
    </div>
{% endblock content %}