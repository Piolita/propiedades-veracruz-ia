{% extends "base.html" %} {# Indica que esta plantilla hereda de base.html #}

{% block title %}Editar Propiedad - {{ propiedad.titulo }}{% endblock %} {# Título dinámico con el nombre de la propiedad #}

{% block content %} {# Bloque de contenido principal de la página #}
    <div class="container"> {# Contenedor para centrar y dar espacio al formulario #}
        <h1>Editar Propiedad: {{ propiedad.titulo }}</h1>
        {# IMPORTANTE: enctype="multipart/form-data" es necesario para la carga de archivos #}
        {# La acción del formulario ahora apunta a la ruta de edición con el ID de la propiedad #}
        <form method="POST" action="{{ url_for('main.edit_property', property_id=propiedad.id) }}" enctype="multipart/form-data">
            <label for="titulo">Título:</label> {# Etiqueta para el campo de entrada #}
            <input type="text" id="titulo" name="titulo" value="{{ propiedad.titulo }}" required> {# Pre-rellena con el título actual #}

            <label for="descripcion">Descripción:</label>
            <textarea id="descripcion" name="descripcion" rows="5" required>{{ propiedad.descripcion }}</textarea> {# Pre-rellena con la descripción actual #}

            <label for="precio">Precio:</label>
            <input type="number" id="precio" name="precio" step="0.01" value="{{ propiedad.precio }}" required> {# Pre-rellena con el precio actual #}

            <label for="direccion">Dirección:</label>
            <input type="text" id="direccion" name="direccion" value="{{ propiedad.direccion }}" required>

            <label for="municipio">Municipio:</label>
            <input type="text" id="municipio" name="municipio" value="{{ propiedad.municipio }}" required>

            <label for="estado">Estado:</label>
            <input type="text" id="estado" name="estado" value="{{ propiedad.estado }}" required> {# Valor predeterminado "Veracruz" #}

            <label for="codigo_postal">Código Postal:</label>
            <input type="text" id="codigo_postal" name="codigo_postal" value="{{ propiedad.codigo_postal if propiedad.codigo_postal else '' }}"> {# Pre-rellena, maneja si es None #}

            <label for="num_habitaciones">Número de Habitaciones:</label>
            <input type="number" id="num_habitaciones" name="num_habitaciones" value="{{ propiedad.num_habitaciones }}" required>

            <label for="num_banos">Número de Baños:</label>
            <input type="number" id="num_banos" name="num_banos" value="{{ propiedad.num_banos }}" required>

            <label for="num_medios_banos">Número de Medios Baños:</label> {# Etiqueta para el campo de medios baños #}
            <input type="number" id="num_medios_banos" name="num_medios_banos" value="{{ propiedad.num_medios_banos if propiedad.num_medios_banos else '' }}"> {# Pre-rellena, maneja si es None #}

            <label for="num_estacionamientos">Número de Estacionamientos:</label>
            <input type="number" id="num_estacionamientos" name="num_estacionamientos" value="{{ propiedad.num_estacionamientos if propiedad.num_estacionamientos else '' }}"> {# Pre-rellena, maneja si es None #}

            <label for="antiguedad">Antigüedad (años):</label> {# Etiqueta para el campo de antigüedad #}
            <input type="number" id="antiguedad" name="antiguedad" value="{{ propiedad.antiguedad if propiedad.antiguedad else '' }}"> {# Pre-rellena, maneja si es None #}

            <label for="area_terreno_metros_cuadrados">Área de Terreno (m²):</label>
            <input type="number" id="area_terreno_metros_cuadrados" name="area_terreno_metros_cuadrados" step="0.01" value="{{ propiedad.area_terreno_metros_cuadrados if propiedad.area_terreno_metros_cuadrados else '' }}"> {# Pre-rellena, maneja si es None #}

            <label for="area_construccion_metros_cuadrados">Área de Construcción (m²):</label>
            <input type="number" id="area_construccion_metros_cuadrados" name="area_construccion_metros_cuadrados" step="0.01" value="{{ propiedad.area_construccion_metros_cuadrados }}" required>

            <label for="tipo">Tipo de Propiedad:</label>
            <select id="tipo" name="tipo" required> {# Menú desplegable para el tipo de propiedad #}
                <option value="">Seleccione un tipo</option>
                {# Marca la opción como seleccionada si coincide con el tipo de propiedad actual #}
                <option value="Casa" {% if propiedad.tipo == 'Casa' %}selected{% endif %}>Casa</option>
                <option value="Departamento" {% if propiedad.tipo == 'Departamento' %}selected{% endif %}>Departamento</option>
                <option value="Terreno" {% if propiedad.tipo == 'Terreno' %}selected{% endif %}>Terreno</option>
                <option value="Oficina" {% if propiedad.tipo == 'Oficina' %}selected{% endif %}>Oficina</option>
                <option value="Local Comercial" {% if propiedad.tipo == 'Local Comercial' %}selected{% endif %}>Local Comercial</option>
                <option value="Bodega" {% if propiedad.tipo == 'Bodega' %}selected{% endif %}>Bodega</option>
                <option value="Rancho" {% if propiedad.tipo == 'Rancho' %}selected{% endif %}>Rancho</option>
            </select>

            <label for="cuota_mantenimiento">Cuota de Mantenimiento:</label>
            <input type="number" id="cuota_mantenimiento" name="cuota_mantenimiento" step="0.01" value="{{ propiedad.cuota_mantenimiento if propiedad.cuota_mantenimiento else '' }}"> {# Pre-rellena, maneja si es None #}

            <label for="estado_propiedad">Estado de la Propiedad:</label>
            <select id="estado_propiedad" name="estado_propiedad" required> {# Menú desplegable para el estado de la propiedad #}
                <option value="">Seleccione un estado</option>
                {# Marca la opción como seleccionada si coincide con el estado de propiedad actual #}
                <option value="Venta" {% if propiedad.estado_propiedad == 'Venta' %}selected{% endif %}>Venta</option>
                <option value="Alquiler" {% if propiedad.estado_propiedad == 'Alquiler' %}selected{% endif %}>Alquiler</option>
            </select>

            {# Sección para las imágenes existentes (sección futura para eliminar/marcar principal) #}
            <h2>Imágenes Actuales</h2>
            <div class="current-images-gallery">
                {% if propiedad.imagenes %}
                    {% for imagen in propiedad.imagenes %}
                        <div class="image-preview-item">
                            <img src="{{ url_for('static', filename='uploads/' + imagen.nombre_archivo) }}" alt="Imagen actual">
                            <p>Principal: {{ 'Sí' if imagen.es_principal else 'No' }}</p>
                            {# Futuros botones para eliminar o marcar como principal #}
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No hay imágenes subidas para esta propiedad.</p>
                {% endif %}
            </div>

            {# Campo para añadir nuevas imágenes #}
            <label for="imagenes">Añadir Nuevas Imágenes (múltiples):</label>
            <input type="file" id="imagenes" name="imagenes" accept="image/*" multiple>

            <button type="submit">Actualizar Propiedad</button> {# Botón para enviar el formulario #}
        </form>
    </div>
{% endblock %}