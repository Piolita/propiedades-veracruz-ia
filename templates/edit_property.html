{# templates/edit_property.html #}

{% extends "base.html" %}

{% block title %}Editar Propiedad{% endblock %}

{% block content %}
    {# Añadido container, row, col y padding/margin para centrar y estilizar #}
    <div class="container my-5 pt-5"> 
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                <div class="card shadow-lg border-0 rounded-lg p-4"> {# Añadido padding al card #}
                    {# Título principal del formulario #}
                    <h1 class="text-center mb-4 display-5 fw-bold text-primary">Editar Propiedad: {{ property.titulo }}</h1>
                    
                    <form method="POST" action="" enctype="multipart/form-data" novalidate>
                        {{ form.hidden_tag() }} 
                        
                        <fieldset class="form-group">
                            {# La leyenda ya no necesita border-bottom si el h1 es suficiente #}
                            {# <legend class="border-bottom mb-4">Editar Propiedad: {{ property.titulo }}</legend> #}

                            <!-- Título -->
                            {# CAMBIO: form-group a mb-3 #}
                            <div class="mb-3">
                                {{ form.titulo.label(class="form-label") }} {# CAMBIO: form-control-label a form-label #}
                                {{ form.titulo(class="form-control form-control-lg {% if form.titulo.errors %}is-invalid{% endif %}") }}
                                {% if form.titulo.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.titulo.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Descripción -->
                            {# CAMBIO: form-group a mb-3 #}
                            <div class="mb-3">
                                {{ form.descripcion.label(class="form-label") }}
                                {{ form.descripcion(class="form-control form-control-lg {% if form.descripcion.errors %}is-invalid{% endif %}", rows=5) }}
                                {% if form.descripcion.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.descripcion.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Precio -->
                            {# CAMBIO: form-group a mb-3 #}
                            <div class="mb-3">
                                {{ form.precio.label(class="form-label") }}
                                {{ form.precio(class="form-control form-control-lg {% if form.precio.errors %}is-invalid{% endif %}") }}
                                {% if form.precio.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.precio.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Ubicación -->
                            {# CAMBIO: form-group a mb-3 #}
                            <div class="mb-3">
                                {{ form.ubicacion.label(class="form-label") }}
                                {{ form.ubicacion(class="form-control form-control-lg {% if form.ubicacion.errors %}is-invalid{% endif %}") }}
                                {% if form.ubicacion.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.ubicacion.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Municipio -->
                            {# CAMBIO: form-group a mb-3 #}
                            <div class="mb-3">
                                {{ form.municipio.label(class="form-label") }}
                                {{ form.municipio(class="form-control form-control-lg {% if form.municipio.errors %}is-invalid{% endif %}") }}
                                {% if form.municipio.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.municipio.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Opciones de la Propiedad (Venta/Renta) -->
                            {# CAMBIO: form-group a mb-3, y form-control a form-select para <select> #}
                            <div class="mb-3">
                                {{ form.property_options.label(class="form-label") }} 
                                {{ form.property_options(class="form-select form-select-lg {% if form.property_options.errors %}is-invalid{% endif %}") }} 
                                {% if form.property_options.errors %} 
                                    <div class="invalid-feedback">
                                        {% for error in form.property_options.errors %} 
                                            <span>{{ error }}</span>
                                        {% endfor %}                                       
                                     </div>
                                {% endif %}
                            </div>

                            <!-- Tipo de Propiedad -->
                            {# CAMBIO: form-group a mb-3, y form-control a form-select para <select> #}
                            <div class="mb-3">
                                {{ form.tipo_propiedad.label(class="form-label") }}
                                {{ form.tipo_propiedad(class="form-select form-select-lg {% if form.tipo_propiedad.errors %}is-invalid{% endif %}") }}
                                {% if form.tipo_propiedad.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.tipo_propiedad.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Campos numéricos opcionales -->
                            {# CAMBIO: form-row a row g-3 (g-3 para espaciado entre columnas) #}
                            <div class="row g-3 mb-3"> {# Añadido mb-3 para el margen inferior de la fila #}
                                {# CAMBIO: form-group col-md-4 a col-md-4 #}
                                <div class="col-md-4">
                                    {{ form.num_habitaciones.label(class="form-label") }}
                                    {{ form.num_habitaciones(class="form-control {% if form.num_habitaciones.errors %}is-invalid{% endif %}") }}
                                    {% if form.num_habitaciones.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.num_habitaciones.errors %}
                                                <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                {# CAMBIO: form-group col-md-4 a col-md-4 #}
                                <div class="col-md-4">
                                    {{ form.num_banos.label(class="form-label") }}
                                    {{ form.num_banos(class="form-control {% if form.num_banos.errors %}is-invalid{% endif %}") }}
                                    {% if form.num_banos.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.num_banos.errors %}
                                                <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                {# CAMBIO: form-group col-md-4 a col-md-4 #}
                                <div class="col-md-4">
                                    {{ form.num_medios_banos.label(class="form-label") }}
                                    {{ form.num_medios_banos(class="form-control {% if form.num_medios_banos.errors %}is-invalid{% endif %}") }}
                                    {% if form.num_medios_banos.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.num_medios_banos.errors %}
                                                <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            {# CAMBIO: form-row a row g-3 #}
                            <div class="row g-3 mb-3"> {# Añadido mb-3 para el margen inferior de la fila #}
                                {# CAMBIO: form-group col-md-4 a col-md-4 #}
                                <div class="col-md-4">
                                    {{ form.num_estacionamientos.label(class="form-label") }}
                                    {{ form.num_estacionamientos(class="form-control {% if form.num_estacionamientos.errors %}is-invalid{% endif %}") }}
                                    {% if form.num_estacionamientos.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.num_estacionamientos.errors %}
                                                <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                {# CAMBIO: form-group col-md-4 a col-md-4 #}
                                <div class="col-md-4">
                                    {{ form.area_terreno_metros_cuadrados.label(class="form-label") }}
                                    {{ form.area_terreno_metros_cuadrados(class="form-control {% if form.area_terreno_metros_cuadrados.errors %}is-invalid{% endif %}") }}
                                    {% if form.area_terreno_metros_cuadrados.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.area_terreno_metros_cuadrados.errors %}
                                                <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                {# CAMBIO: form-group col-md-4 a col-md-4 #}
                                <div class="col-md-4">
                                    {{ form.area_construccion_metros_cuadrados.label(class="form-label") }}
                                    {{ form.area_construccion_metros_cuadrados(class="form-control {% if form.area_construccion_metros_cuadrados.errors %}is-invalid{% endif %}") }}
                                    {% if form.area_construccion_metros_cuadrados.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.area_construccion_metros_cuadrados.errors %}
                                                <span>{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Cuota de Mantenimiento -->
                            {# CAMBIO: form-group a mb-3 #}
                            <div class="mb-3">
                                {{ form.cuota_mantenimiento.label(class="form-label") }}
                                {{ form.cuota_mantenimiento(class="form-control form-control-lg {% if form.cuota_mantenimiento.errors %}is-invalid{% endif %}") }}
                                {% if form.cuota_mantenimiento.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.cuota_mantenimiento.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Campo de Imágenes -->
                            {# CAMBIO: form-group a mb-3, y manejo de input file #}
                            <div class="mb-3">
                                {{ form.imagenes.label(class="form-label") }}
                                {{ form.imagenes(class="form-control {% if form.imagenes.errors %}is-invalid{% endif %}", multiple=True) }}
                                {# La etiqueta "Elegir nuevo(s) archivo(s)" ya no es necesaria con form-control en BS5 #}
                                {# <label class="custom-file-label" for="imagenes">Elegir nuevo(s) archivo(s)</label> #}
                                {% if form.imagenes.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.imagenes.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            {# Imágenes existentes: Ajuste de clases para Bootstrap 5 #}
                            {% if property.images %}
                                <div class="mb-3"> {# CAMBIO: form-group mt-3 a mb-3 para consistencia #}
                                    <label class="form-label">Imágenes existentes:</label> {# CAMBIO: form-control-label a form-label #}
                                    <div class="d-flex flex-wrap gap-2"> {# CAMBIO: mr-2 a gap-2 para espaciado entre imágenes #}
                                        {% for image in property.images %} {# CAMBIO: image en lugar de imagen #}
                                            <div class="image-thumbnail-container position-relative"> {# Añadido position-relative para botón de eliminar #}
                                                <img src="{{ url_for('static', filename='uploads/' + image.filename) }}"
                                                     class="img-thumbnail rounded" alt="Imagen de propiedad" style="width: 150px; height: 150px; object-fit: cover;">
                                                {# Opcional: Botón para eliminar imagen individual (requeriría lógica JS/Flask) #}
                                                {# <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0 translate-middle rounded-circle" data-image-id="{{ image.id }}">&times;</button> #}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}

                        </fieldset>
                        <div class="mt-4"> {# CAMBIO: form-group a mt-4 para margen superior #}
                            {{ form.submit(class="btn btn-outline-info w-100") }} {# Añadido w-100 para que ocupe todo el ancho #}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
